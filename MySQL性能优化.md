# MySQL性能优化

## 逻辑架构

可以清晰的查找各层次问题，降低工作量，提高问题解决效率。

### 连接层

不同的语言有不同的连接驱动，用于做数据库连接授权认证。

连接池:循环利用连接，提高性能，创建连接比较耗费性能，所以，数据库，FTP等等都应该有连接池，缓存的概念不外如是。

### 服务层

服务管理，安全，备份，复制，集群等，都属于这个模块。

操作数据库，增删改查，事务，视图等操作。

内部自带优化器，缓存等。

### 引擎层

存储引擎，最常用的有MyISAM,InnoDB

### 存储层

存储与磁盘



## 存储引擎

采用不同的技术存储文件与数据，就形成了各种存储引擎。

show engines   -----查看存储引擎

列：

​	内存：速度快，但不能长期保存。

​	磁盘：相对较慢，但能长期保存。

### MyISAM与InnoDb

0：不支持

1：支持

|   功能   |                            MyISAM                            |                            InnoDB                            |
| :------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|  主外键  |                              0                               |                              1                               |
|   事务   |                              0                               |                              1                               |
|   行锁   |                              0                               |                              1                               |
|   表锁   |                              1                               |                              0                               |
|   缓存   |                    只缓存索引，不缓存数据                    |              对索引和数据都做缓存，内存消耗较大              |
|  表空间  |                              小                              |                              小                              |
|  关注点  |                             性能                             |                         相对下降一些                         |
| 默认安装 |                              1                               |                              1                               |
| 文件结构 | b.frm:描述表结构，字段长度<br />b.MYD(MYData):数据信息文件，存储数据信息(如果采用独立表存储模式)<br />b.MYI(MYIndex):索引信息文件 | b.frm:描述表结构，字段长度等。<br />b.ibd:存储数据信息和索引信息。 |

## SQL的执行顺序

### 代码编写顺序

```mermaid
graph LR
A[操作符]-->B[选择字段]
B-->C[选表]
C-->D[连接的表]
D-->E[on条件]
E-->F[字段条件]
F-->G[分组]
G-->H[排序]
H-->J[limit]
```

### MySQL读取顺序

```mermaid
graph LR
A[选表]-->B[on条件]
B-->C[连接的表]
C-->D[字段条件]
D-->E[分组]
E-->F[操作符]
F-->G[选择字段]
G-->H[排序]
H-->J[limit]
```

### 整体过程

1. 先对多表进行关系，更具条件找出符合条件的记录。
2. 在符合条件的基础上进行再次where条件筛选
3. 对筛选出来的内容进行分组操作。
4. 分组完成后，使用还having再次筛选出瞒住条件的记录。
5. 取所满足条件的记录。
6. 对取出的记录进行排序
7. 最终从取出的记录当中获取多少条记录显示出来。